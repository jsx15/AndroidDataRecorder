@page "/Pi"
@using AndroidDataRecorder.Misc
@using AndroidDataRecorder.Database
@layout PiLayout
<div class="master">
    <div class="row p-3">
        <div class="col-sm-6">
            <div class="card">
                <button class="btn @BtnColor text-center top-row" @onclick="ToggleBtn">@LoggingBtnText</button>
            </div>
        </div>
        <div class="col-sm-6">
            <div class="card">
                <button class="btn btn-primary text-center top-row" @onclick="CreateMarker">Set Marker</button>
            </div>
        </div>
    </div>

    <div class="row p-3">
        <div class="col-sm-6">
            <div class="card">
                <div class="table-wrapper-scroll-y scroll-bar second-row">
                    <table class="table table-striped table-sm">
                        <thead>
                        <tr>
                            <th scope="col">Time</th>
                            <th scope="col">Message</th>
                        </tr>
                        </thead>
                        <tbody>
                        @* Reverse list so last entry is at top *@
                        @foreach (var marker in Enumerable.Reverse(MarkerList.Markers))
                        {
                            <tr>
                                <td style="width: 30%">@marker.timeStamp</td>
                                <td>@marker.message</td>
                            </tr>
                        }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-sm-6">
            <div class="card second-row">
                <div class="card-body ">
                    <div class="row">
                        <div class="col-md-4 text-left">
                            <div>CPU: </div>
                        </div>
                        <div class="col-md-8">
                            <div class="progress">
                                <div class="progress-bar progress-bar-striped" style="width: 12%" role="progressbar" aria-valuenow="12" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4 text-left">
                            <div>Memory: </div>
                        </div>
                        <div class="col-md-8">
                            <div class="progress">
                                <div class="progress-bar progress-bar-striped" style="width: 25%" role="progressbar" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                    </div>

                </div>


            </div>
        </div>
    </div>
</div>


@code {
    /*
     * Bool for logging button
     */
    private bool _toggleLoggingBtn;
    
    /*
     * Database
     */
    Database _database = new Database();
    
    /*
     * MarkerList
     */
    MarkerList _markerList = new MarkerList();

    /*
     * Adjusting CSS
     */
    private string BtnColor => _toggleLoggingBtn ? "btn-danger" : "btn-success";

    private string LoggingBtnText => _toggleLoggingBtn ? "Stop Logging" : "Start Logging";

    /*
     * Toggle logging button
     */
    private void ToggleBtn()
    {
        _toggleLoggingBtn = !_toggleLoggingBtn;
    }

    private void CreateMarker()
    {
        _database.InsertValuesInTableMarker(MarkerList.GetDeviceName(), DateTime.Now, "Marker from pi");
        _markerList.Update();
    }

}